# myIEC60870-5-104
利用esp32做的IEC60870-5-104，可以用wifi/有线以太网连接

# 说明
该软件在 arduino 上通过 IEC60870-5-104 实现通信，您可以使用"MASTER"和"SLAVE"对象的多个实例将 Arduino 与使用此协议的 PLC 或 RTU 连接起来。


# 已经实现的功能

## v1.0.1 支持的功能

| 功能码 | 描述 |
|--------|------|
| M_SP_NA_1 | 单点信息 |
| M_DP_NA_1 | 双点信息 |
| M_ME_NA_1 | 测量值，标准化值 |
| C_SC_NA_1 | 单命令 |
| C_DC_NA_1 | 双命令 |
| C_IC_NA_1 | 询问命令 |
| M_EI_NA_1 | 初始化结束 |

## 参数设置

通过命令`setParam(byte,bool)`，您可以设置要在连接建立时发送的电报：

* **0** - M_EI_NA_1 - 初始化结束
* **1** - C_IC_NA_1 - 询问命令（仅对 MASTER 实例有效）

## 硬件兼容性

该库已在 ESP32 上使用 WiFi 和以太网进行了测试。

### 启用有线模式

要启用 WIRED 模式，您需要：

1. 在 IEC60870-5-104.h 文件中添加 `#define IECWIRED`
2. 对于 ESP32，以太网库需要修改 Server.h 文件：
   * 将 `virtual void begin(uint16_t port=0) =0;` 
   * 更改为 `virtual void begin() =0;`（不带逗号）

# 标准IEC60870-5-104协议与当前实现对比

## 信息对象类型对比

下表展示了标准IEC60870-5-104协议中的主要信息对象类型与当前项目已实现功能的对比：

| 类型标识 | 描述 | 标准协议 | 当前实现 |
|---------|------|---------|---------|
| M_SP_NA_1 (1) | 单点信息 | ✓ | ✓ |
| M_SP_TA_1 (2) | 带时标的单点信息 | ✓ | ✗ |
| M_DP_NA_1 (3) | 双点信息 | ✓ | ✓ |
| M_DP_TA_1 (4) | 带时标的双点信息 | ✓ | ✗ |
| M_ST_NA_1 (5) | 步位置信息 | ✓ | ✗ |
| M_ST_TA_1 (6) | 带时标的步位置信息 | ✓ | ✗ |
| M_BO_NA_1 (7) | 32比特串 | ✓ | ✗ |
| M_BO_TA_1 (8) | 带时标的32比特串 | ✓ | ✗ |
| M_ME_NA_1 (9) | 测量值，标准化值 | ✓ | ✓ |
| M_ME_TA_1 (10) | 带时标的测量值，标准化值 | ✓ | ✗ |
| M_ME_NB_1 (11) | 测量值，标度值 | ✓ | ✗ |
| M_ME_TB_1 (12) | 带时标的测量值，标度值 | ✓ | ✗ |
| M_ME_NC_1 (13) | 测量值，短浮点数 | ✓ | ✗ |
| M_ME_TC_1 (14) | 带时标的测量值，短浮点数 | ✓ | ✗ |
| M_IT_NA_1 (15) | 累计量 | ✓ | ✗ |
| M_IT_TA_1 (16) | 带时标的累计量 | ✓ | ✗ |
| M_EP_TA_1 (17) | 带时标的继电保护设备事件 | ✓ | ✗ |
| M_EP_TB_1 (18) | 带时标的继电保护设备成组启动事件 | ✓ | ✗ |
| M_EP_TC_1 (19) | 带时标的继电保护设备成组输出电路信息 | ✓ | ✗ |
| M_PS_NA_1 (20) | 具有状态变位检出的成组单点信息 | ✓ | ✗ |
| M_ME_ND_1 (21) | 测量值，不带品质描述词的标准化值 | ✓ | ✗ |
| M_SP_TB_1 (30) | 带时标CP56Time2a的单点信息 | ✓ | ✗ |
| M_DP_TB_1 (31) | 带时标CP56Time2a的双点信息 | ✓ | ✗ |
| M_ST_TB_1 (32) | 带时标CP56Time2a的步位置信息 | ✓ | ✗ |
| M_BO_TB_1 (33) | 带时标CP56Time2a的32位串 | ✓ | ✗ |
| M_ME_TD_1 (34) | 带时标CP56Time2a的测量值，标准化值 | ✓ | ✗ |
| M_ME_TE_1 (35) | 带时标CP56Time2a的测量值，标度值 | ✓ | ✗ |
| M_ME_TF_1 (36) | 带时标CP56Time2a的测量值，短浮点数 | ✓ | ✗ |
| M_IT_TB_1 (37) | 带时标CP56Time2a的累计量 | ✓ | ✗ |
| M_EP_TD_1 (38) | 带时标CP56Time2a的继电保护设备事件 | ✓ | ✗ |
| M_EP_TE_1 (39) | 带时标CP56Time2a的继电保护设备成组启动事件 | ✓ | ✗ |
| M_EP_TF_1 (40) | 带时标CP56Time2a的继电保护设备成组输出电路信息 | ✓ | ✗ |
| C_SC_NA_1 (45) | 单命令 | ✓ | ✓ |
| C_DC_NA_1 (46) | 双命令 | ✓ | ✓ |
| C_RC_NA_1 (47) | 升降命令 | ✓ | ✗ |
| C_SE_NA_1 (48) | 设点命令，标准化值 | ✓ | ✗ |
| C_SE_NB_1 (49) | 设点命令，标度值 | ✓ | ✗ |
| C_SE_NC_1 (50) | 设点命令，短浮点数 | ✓ | ✗ |
| C_BO_NA_1 (51) | 32比特串 | ✓ | ✗ |
| C_SC_TA_1 (58) | 带时标CP56Time2a的单命令 | ✓ | ✗ |
| C_DC_TA_1 (59) | 带时标CP56Time2a的双命令 | ✓ | ✗ |
| C_RC_TA_1 (60) | 带时标CP56Time2a的升降命令 | ✓ | ✗ |
| C_SE_TA_1 (61) | 带时标CP56Time2a的设点命令，标准化值 | ✓ | ✗ |
| C_SE_TB_1 (62) | 带时标CP56Time2a的设点命令，标度值 | ✓ | ✗ |
| C_SE_TC_1 (63) | 带时标CP56Time2a的设点命令，短浮点数 | ✓ | ✗ |
| C_BO_TA_1 (64) | 带时标CP56Time2a的32比特串 | ✓ | ✗ |
| C_IC_NA_1 (100) | 总召唤命令 | ✓ | ✓ |
| C_CI_NA_1 (101) | 电能脉冲召唤命令 | ✓ | ✗ |
| C_RD_NA_1 (102) | 读命令 | ✓ | ✗ |
| C_CS_NA_1 (103) | 时钟同步命令 | ✓ | ✗ |
| C_TS_NA_1 (104) | 测试命令 | ✓ | ✗ |
| C_RP_NA_1 (105) | 复位进程命令 | ✓ | ✗ |
| C_CD_NA_1 (106) | 延时获得命令 | ✓ | ✗ |
| C_TS_TA_1 (107) | 带时标CP56Time2a的测试命令 | ✓ | ✗ |
| P_ME_NA_1 (110) | 参数，测量值，标准化值 | ✓ | ✗ |
| P_ME_NB_1 (111) | 参数，测量值，标度值 | ✓ | ✗ |
| P_ME_NC_1 (112) | 参数，测量值，短浮点数 | ✓ | ✗ |
| P_AC_NA_1 (113) | 参数激活 | ✓ | ✗ |
| F_FR_NA_1 (120) | 文件准备就绪 | ✓ | ✗ |
| F_SR_NA_1 (121) | 节准备就绪 | ✓ | ✗ |
| F_SC_NA_1 (122) | 召唤目录，选择文件，召唤文件，召唤节 | ✓ | ✗ |
| F_LS_NA_1 (123) | 最后的节，最后的段 | ✓ | ✗ |
| F_AF_NA_1 (124) | 认可文件，认可节 | ✓ | ✗ |
| F_SG_NA_1 (125) | 段 | ✓ | ✗ |
| F_DR_TA_1 (126) | 目录 | ✓ | ✗ |
| F_SC_NB_1 (127) | 查询日志，请求日志 | ✓ | ✗ |
| M_EI_NA_1 (70) | 初始化结束 | ✓ | ✓ |

## 开发计划

未来版本将逐步实现更多标准协议中的功能，优先级如下：

1. 带时标的信息对象（M_SP_TA_1, M_DP_TA_1等）
2. 测量值的其他类型（标度值、短浮点数）
3. 时钟同步命令（C_CS_NA_1）
4. 读命令（C_RD_NA_1）
5. 其他控制命令和参数类型

## 贡献

欢迎提交Pull Request来帮助实现更多的协议功能。如有任何问题或建议，请提交Issue。